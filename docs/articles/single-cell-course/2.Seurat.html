<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lesson 2: Basic Single-Cell Analysis Workflow with Seurat • SeuratExtend</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Lesson 2: Basic Single-Cell Analysis Workflow with Seurat">
<meta property="og:description" content="SeuratExtend">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">SeuratExtend</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/News.html">What's New in v1.1.0</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../../articles/Visualization.html">Enhanced Visualization</a>
    </li>
    <li>
      <a href="../../articles/GSEA.html">Geneset Enrichment Analysis (GSEA) </a>
    </li>
    <li>
      <a href="../../articles/Trajectory.html">Trajectory and Pseudotime Analysis </a>
    </li>
    <li>
      <a href="../../articles/SCENIC.html">SCENIC for Gene Regulatory Networks Analysis </a>
    </li>
    <li>
      <a href="../../articles/Utilities.html">Utility Tools and Functions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    scRNA-seq Course
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/single-cell-course/1.basic-R.html">1. Introduction to R</a>
    </li>
    <li>
      <a href="../../articles/single-cell-course/2.Seurat.html">2. Basic Single-Cell Analysis Workflow</a>
    </li>
    <li>
      <a href="../../articles/single-cell-course/3.Visualization.html">3. Advanced Visualization Techniques</a>
    </li>
    <li>
      <a href="../../articles/single-cell-course/4.GSEA.html">4. Gene Set Enrichment Analysis</a>
    </li>
    <li>
      <a href="../../articles/single-cell-course/5.Core-Enhancement.html">5. Core scRNA-seq Workflow Enhancements</a>
    </li>
    <li>
      <a href="../../articles/single-cell-course/6.Advanced.html">6. Advanced Methods (Part 1)</a>
    </li>
    <li>
      <a href="../../articles/single-cell-course/6.Advanced-2.html">7. Advanced Methods (Part 2)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/FAQ.html">FAQ</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lesson 2: Basic Single-Cell Analysis Workflow
with Seurat</h1>
                        <h4 data-toc-skip class="author">Yichao Hua</h4>
            
            <h4 data-toc-skip class="date">2024-11-29</h4>
      
      
      <div class="hidden name"><code>2.Seurat.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-single-cell-analysis-with-seurat">Introduction to Single-Cell Analysis with Seurat<a class="anchor" aria-label="anchor" href="#introduction-to-single-cell-analysis-with-seurat"></a>
</h2>
<p><a href="https://satijalab.org/seurat/" class="external-link">Seurat</a> is the most
popular framework for analyzing single-cell data in R. It provides
structured data storage, basic analysis workflows, and visualization
solutions. Before we dive into the code, let’s introduce some
fundamental concepts and principles of single-cell data analysis. This
background will help us better understand the process.</p>
<div class="section level3">
<h3 id="from-raw-data-to-visualization-the-single-cell-analysis-journey">From Raw Data to Visualization: The Single-Cell Analysis
Journey<a class="anchor" aria-label="anchor" href="#from-raw-data-to-visualization-the-single-cell-analysis-journey"></a>
</h3>
<p>When we first receive sequencing data, it’s typically in the form of
FASTQ files. These are text files that contain the raw nucleotide
sequences. A typical FASTQ file looks like this:</p>
<div class="float">
<img src="images/fastq_example.png" width="500" alt="FASTQ File Example"><div class="figcaption">FASTQ File Example</div>
</div>
<p>A key milestone in our single-cell analysis journey is to visualize
cells using a UMAP (Uniform Manifold Approximation and Projection) plot,
with colors distinguishing different cell clusters:</p>
<div class="float">
<img src="images/umap_example.png" alt="UMAP Example"><div class="figcaption">UMAP Example</div>
</div>
<p>So, what happens between the raw FASTQ files and the final UMAP
visualization? Here’s a simplified flowchart of the process:</p>
<div class="float">
<img src="images/sc_analysis_flowchart.png" alt="Single-Cell Analysis Flowchart"><div class="figcaption">Single-Cell Analysis Flowchart</div>
</div>
<p>Let’s break down each step of this process:</p>
</div>
<div class="section level3">
<h3 id="mapping">1. Mapping<a class="anchor" aria-label="anchor" href="#mapping"></a>
</h3>
<p>This step aligns the raw sequences from the FASTQ files to a
reference genome, resulting in a gene count matrix:</p>
<div class="float">
<img src="images/gene_count_matrix.png" alt="Gene Count Matrix"><div class="figcaption">Gene Count Matrix</div>
</div>
<p>In this matrix: - Rows represent gene names - Columns represent cell
names - Each cell contains a non-negative integer representing the
number of reads for each gene in each cell</p>
<p>A “read” is an important concept - it represents one RNA fragment.
For 10X sequencing data, this step is typically performed using
CellRanger on a Linux server rather than a personal computer.</p>
</div>
<div class="section level3">
<h3 id="data-normalization">2. Data Normalization<a class="anchor" aria-label="anchor" href="#data-normalization"></a>
</h3>
<p>From this point onwards, we’ll be working on our personal computers.
When we import the gene count matrix, we can’t use it directly for
analysis because each cell has a different sequencing depth and read
count, making direct comparisons impossible. Normalization addresses
this issue in two steps:</p>
<ol style="list-style-type: lower-alpha">
<li>Normalize by library size</li>
<li>Log transform</li>
</ol>
<p>The result is a matrix of the same size as the gene count matrix, but
containing normalized gene expression values:</p>
<div class="float">
<img src="images/normalized_gene_expression.png" alt="Normalized Gene Expression"><div class="figcaption">Normalized Gene Expression</div>
</div>
</div>
<div class="section level3">
<h3 id="pca-1st-dimension-reduction">3. PCA (1st Dimension Reduction)<a class="anchor" aria-label="anchor" href="#pca-1st-dimension-reduction"></a>
</h3>
<p>Principal Component Analysis (PCA) is our first step in dimension
reduction. The original data has too many dimensions (e.g., 20,000 genes
or features), making direct analysis computationally intensive. PCA
reduces this to about 20-50 principal components (PCs).</p>
<p>We can roughly understand each PC as representing a group of genes
that characterize or distinguish different cell types. For example, PC1
might relate to macrophages, PC2 to lymphocytes, and so on. Using PC1
and PC2, we can start to distinguish between macrophages, lymphocytes,
and other cell types.</p>
<p>The output of this step is still a matrix, but much smaller than the
original normalized matrix. It changes from a row (~20k genes) x column
(cells) matrix to a row (cells) x column (20-50 PCs) matrix:</p>
<div class="float">
<img src="images/pca_output.png" alt="PCA Output"><div class="figcaption">PCA Output</div>
</div>
</div>
<div class="section level3">
<h3 id="unsupervised-clustering">4. Unsupervised Clustering<a class="anchor" aria-label="anchor" href="#unsupervised-clustering"></a>
</h3>
<p>After the first PCA dimension reduction, we perform two parallel
steps. One of these is unsupervised clustering.</p>
<p>Imagine a three-dimensional space where each point represents a cell.
Cells that are closer in this space have more similar characteristics,
so we group nearby cells into the same cluster. While our brains can
only visualize three dimensions, computers can work in higher
dimensions.</p>
<p>Using information from a selected number of top PCs (often ranging
from 10 to 50, depending on the dataset), algorithms help us find and
group similar cells in this high-dimensional space. The optimal number
of PCs to use can vary based on the complexity and characteristics of
your data.</p>
<div class="float">
<img src="images/unsupervised_clustering.png" width="300" alt="Unsupervised Clustering"><div class="figcaption">Unsupervised Clustering</div>
</div>
</div>
<div class="section level3">
<h3 id="visualization-umapt-sne-2nd-dimension-reduction">5. Visualization: UMAP/t-SNE (2nd Dimension Reduction)<a class="anchor" aria-label="anchor" href="#visualization-umapt-sne-2nd-dimension-reduction"></a>
</h3>
<p>While the first PCA reduction allows us to distinguish some major
groups using PC1 and PC2, more detailed grouping information might be
contained in later PCs. To visualize this information in a
two-dimensional plot, we need a second dimension reduction step. The
most commonly used method for this is UMAP (Uniform Manifold
Approximation and Projection).</p>
<p>UMAP compresses the multi-dimensional PC information (e.g. top 10-50
PCs, depending on the dataset) into two dimensions, allowing us to
visualize cell differences more intuitively. The number of PCs used
should be optimized for each dataset. This step gives us x-y coordinate
points for each cell:</p>
<div class="float">
<img src="images/umap_coordinates.png" alt="UMAP Coordinates"><div class="figcaption">UMAP Coordinates</div>
</div>
</div>
<div class="section level3">
<h3 id="final-visualization">6. Final Visualization<a class="anchor" aria-label="anchor" href="#final-visualization"></a>
</h3>
<p>Finally, we combine the information from unsupervised clustering and
UMAP. We plot each cell on the UMAP coordinates and color-code them
based on their cluster assignment. This gives us the standard UMAP plot
we aim for in single-cell analysis:</p>
<div class="float">
<img src="images/final_umap.png" alt="Final UMAP"><div class="figcaption">Final UMAP</div>
</div>
<p>This overview covers the basic workflow and principles of single-cell
analysis. In the next section, we’ll learn how to implement these steps
using R code and the Seurat package.</p>
</div>
</div>
<div class="section level2">
<h2 id="implementing-single-cell-analysis-with-seurat">Implementing Single-Cell Analysis with Seurat<a class="anchor" aria-label="anchor" href="#implementing-single-cell-analysis-with-seurat"></a>
</h2>
<p>Now that we understand the basic workflow, let’s implement these
steps using R code and the Seurat package.</p>
<div class="section level3">
<h3 id="load-required-libraries">1. Load Required Libraries<a class="anchor" aria-label="anchor" href="#load-required-libraries"></a>
</h3>
<p>Before we begin, make sure you have installed the Seurat package. If
you haven’t, you can install it using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("Seurat")</span></span></code></pre></div>
<p>Now, let’s load the library:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-the-data">2. Load the Data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h3>
<p>First, let’s set your working directory to where we’ll store all
course materials. If you followed Lesson 1, this would be:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set working directory to the course folder created in Lesson 1</span></span>
<span><span class="co"># If you used a different location, replace this path with your chosen directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"~/Documents/single-cell-course"</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s download and extract the course data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download the course data (this may take a few minutes depending on your internet connection)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://zenodo.org/records/14245429/files/single-cell-course-data.zip"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"course_data.zip"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the downloaded zip file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"course_data.zip"</span>, exdir <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll be using a pre-downloaded 10x Genomics dataset of 3k PBMCs
(Peripheral Blood Mononuclear Cells). The original dataset is available
from <a href="https://cf.10xgenomics.com/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz" class="external-link">this
link</a>. The data should now be in a folder named
“data/pbmc3k/filtered_gene_bc_matrices/”.</p>
<p>This is a typical format for a gene count matrix from 10X CellRanger
output. It includes three files: barcodes, genes/features, and matrix.
We’ll use Seurat’s <code>Read10X</code> function to read this
information into R:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/Read10X.html" class="external-link">Read10X</a></span><span class="op">(</span><span class="st">"data/pbmc3k/filtered_gene_bc_matrices/"</span><span class="op">)</span></span>
<span><span class="va">raw_matrix</span><span class="op">[</span><span class="fl">101</span><span class="op">:</span><span class="fl">120</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## 20 x 20 sparse Matrix of class "dgCMatrix"</span></span></code></pre>
<pre><code><span><span class="co">##   [[ suppressing 20 column names 'AAACATACAACCAC-1', 'AAACATTGAGCTAC-1', 'AAACATTGATCAGC-1' ... ]]</span></span></code></pre>
<pre><code><span><span class="co">##                                                      </span></span>
<span><span class="co">## GABRD         . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## RP11-547D24.3 . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## PRKCZ         . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## RP5-892K4.1   . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## RP11-181G12.2 . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## C1orf86       . . . . . . . . 1 . . . . . . . . . . .</span></span>
<span><span class="co">## AL590822.2    . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## AL590822.1    . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## RP11-181G12.5 . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## RP11-181G12.4 . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## SKI           . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## MORN1         . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## AL589739.1    . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## RER1          . 1 1 1 . . . . . . . 1 . 1 . . . . 2 .</span></span>
<span><span class="co">## PEX10         . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## PLCH2         . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## RP3-395M20.2  . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## RP3-395M20.3  . . . . . . . . . . . . . . . . . . . .</span></span>
<span><span class="co">## PANK4         . . 1 . . 1 . . . . . . . . . . . . . .</span></span>
<span><span class="co">## HES5          . . . . . . . . . . . . . . . . . . . .</span></span></code></pre>
<p>The code above extracts a portion of the raw count matrix. You’ll see
that rows represent genes, columns represent cells, and the values are
non-negative integers.</p>
</div>
<div class="section level3">
<h3 id="create-a-seurat-object">3. Create a Seurat Object<a class="anchor" aria-label="anchor" href="#create-a-seurat-object"></a>
</h3>
<p>A Seurat object is one of the standardized formats for storing
single-cell data. Let’s create one:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/CreateSeuratObject.html" class="external-link">CreateSeuratObject</a></span><span class="op">(</span></span>
<span>  <span class="va">raw_matrix</span>,</span>
<span>  min.features <span class="op">=</span> <span class="fl">200</span>,  <span class="co"># Keep cells with at least 200 detected genes</span></span>
<span>  project <span class="op">=</span> <span class="st">"pbmc_3k"</span>, <span class="co"># Name of the project</span></span>
<span>  min.cells <span class="op">=</span> <span class="fl">1</span>        <span class="co"># Keep genes detected in at least 1 cell</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Feature names cannot have underscores ('_'), replacing with dashes</span></span>
<span><span class="co">## ('-')</span></span></code></pre>
<p>Let’s take a closer look at our Seurat object. The structure of a
Seurat object is similar to a list, but with a key difference: Seurat
objects have fixed slots, while list elements can be arbitrarily added
or removed. We access slots in a Seurat object using the <code>@</code>
symbol.</p>
<p>To explore the object:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span>  <span class="co"># Opens a viewer to explore the object</span></span></code></pre></div>
<p>There’s a lot of information here, which we’ll gradually become
familiar with. For now, let’s focus on two crucial components:</p>
<ol style="list-style-type: decimal">
<li>The raw count matrix:</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>  <span class="co"># View a small portion of the raw count matrix</span></span></code></pre></div>
<pre><code><span><span class="co">## 20 x 20 sparse Matrix of class "dgCMatrix"</span></span></code></pre>
<pre><code><span><span class="co">##   [[ suppressing 20 column names 'AAACATACAACCAC-1', 'AAACATTGAGCTAC-1', 'AAACATTGATCAGC-1' ... ]]</span></span></code></pre>
<pre><code><span><span class="co">##                                                       </span></span>
<span><span class="co">## AL627309.1    . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## AP006222.2    . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## RP11-206L10.2 . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## RP11-206L10.9 . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## FAM87B        . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## LINC00115     . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## FAM41C        . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## SAMD11        . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## NOC2L         . . . . . . . . . . . 1 . . . . . . .  .</span></span>
<span><span class="co">## KLHL17        . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## PLEKHN1       . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## RP11-54O7.17  . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## HES4          . . . . . . . . . . . . . . . . . . 1  .</span></span>
<span><span class="co">## RP11-54O7.11  . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## ISG15         . . 1 9 . 1 . . . 3 . . 1 5 . 2 1 1 1  .</span></span>
<span><span class="co">## AGRN          . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## C1orf159      . . . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## TNFRSF18      . 2 . . . . . . . . . . . . . . . . .  .</span></span>
<span><span class="co">## TNFRSF4       . . . . . . . . 1 . . . . . . . . . . 12</span></span>
<span><span class="co">## SDF4          . . 1 . . . . . . . . . . . . . . . .  1</span></span></code></pre>
<ol start="2" style="list-style-type: decimal">
<li>The meta.data, a data frame storing information about all
cells:</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span>  <span class="co"># View metadata associated with cells</span></span></code></pre></div>
<pre><code><span><span class="co">##                  orig.ident nCount_RNA nFeature_RNA</span></span>
<span><span class="co">## AAACATACAACCAC-1    pbmc_3k       2421          781</span></span>
<span><span class="co">## AAACATTGAGCTAC-1    pbmc_3k       4903         1352</span></span>
<span><span class="co">## AAACATTGATCAGC-1    pbmc_3k       3149         1131</span></span>
<span><span class="co">## AAACCGTGCTTCCG-1    pbmc_3k       2639          960</span></span>
<span><span class="co">## AAACCGTGTATGCG-1    pbmc_3k        981          522</span></span>
<span><span class="co">## AAACGCACTGGTAC-1    pbmc_3k       2164          782</span></span></code></pre>
<p>Seurat automatically creates three columns in the meta.data:</p>
<ul>
<li>
<code>orig.ident</code>: Usually indicates the sample source (we
only have one sample here)</li>
<li>
<code>nFeature_RNA</code>: Refers to nGene, the number of genes
detected in the cell</li>
<li>
<code>nCount_RNA</code>: Refers to the number of reads, representing
sequencing depth</li>
</ul>
<p>If we want to add cell-related information later (such as clustering
or treatment conditions), we’ll add it to meta.data.</p>
<p>You can view all cell names and gene names using
<code><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames()</a></code> and <code><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames()</a></code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>  <span class="co"># View cell names</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "AAACATACAACCAC-1" "AAACATTGAGCTAC-1" "AAACATTGATCAGC-1" "AAACCGTGCTTCCG-1"</span></span>
<span><span class="co">##  [5] "AAACCGTGTATGCG-1" "AAACGCACTGGTAC-1" "AAACGCTGACCAGT-1" "AAACGCTGGTTCTT-1"</span></span>
<span><span class="co">##  [9] "AAACGCTGTAGCCA-1" "AAACGCTGTTTCTG-1"</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>  <span class="co"># View gene names</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "AL627309.1"    "AP006222.2"    "RP11-206L10.2" "RP11-206L10.9"</span></span>
<span><span class="co">##  [5] "FAM87B"        "LINC00115"     "FAM41C"        "SAMD11"       </span></span>
<span><span class="co">##  [9] "NOC2L"         "KLHL17"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="normalize-the-data">4. Normalize the Data<a class="anchor" aria-label="anchor" href="#normalize-the-data"></a>
</h3>
<p>This step adjusts for differences in sequencing depth between
cells:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html" class="external-link">NormalizeData</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Normalizing layer: counts</span></span></code></pre>
<p>Let’s view a portion of the normalized data:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## 20 x 10 sparse Matrix of class "dgCMatrix"</span></span></code></pre>
<pre><code><span><span class="co">##   [[ suppressing 10 column names 'AAACATACAACCAC-1', 'AAACATTGAGCTAC-1', 'AAACATTGATCAGC-1' ... ]]</span></span></code></pre>
<pre><code><span><span class="co">##                                                                           </span></span>
<span><span class="co">## AL627309.1    . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## AP006222.2    . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## RP11-206L10.2 . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## RP11-206L10.9 . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## FAM87B        . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## LINC00115     . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## FAM41C        . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## SAMD11        . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## NOC2L         . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## KLHL17        . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## PLEKHN1       . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## RP11-54O7.17  . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## HES4          . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## RP11-54O7.11  . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## ISG15         . .        1.429261 3.55831 . 1.726522 . . .        3.339271</span></span>
<span><span class="co">## AGRN          . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## C1orf159      . .        .        .       . .        . . .        .       </span></span>
<span><span class="co">## TNFRSF18      . 1.625141 .        .       . .        . . .        .       </span></span>
<span><span class="co">## TNFRSF4       . .        .        .       . .        . . 2.178946 .       </span></span>
<span><span class="co">## SDF4          . .        1.429261 .       . .        . . .        .</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="identify-variable-features">5. Identify Variable Features<a class="anchor" aria-label="anchor" href="#identify-variable-features"></a>
</h3>
<p>According to our previously discussed workflow, the next step would
be the first dimension reduction using PCA. However, before running PCA,
we need to perform two preparatory steps. The first is to find highly
variable genes, typically defaulting to 2000 genes.</p>
<p>We don’t usually need all genes for cell clustering; we only need the
genes with the most variation, as these often best reflect the
differences between cell types.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span>  <span class="co"># Identify genes that are highly variable across cells</span></span></code></pre></div>
<pre><code><span><span class="co">## Finding variable features for layer counts</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/VariableFeatures.html" class="external-link">VariableFeatures</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span>  <span class="co"># View the variable features</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "PPBP"     "LYZ"      "S100A9"   "IGLL5"    "GNLY"     "FTL"     </span></span>
<span><span class="co">##  [7] "PF4"      "FTH1"     "GNG11"    "FCER1A"   "HLA-DRA"  "S100A8"  </span></span>
<span><span class="co">## [13] "CD74"     "CLU"      "GZMB"     "NKG7"     "C1QA"     "CST3"    </span></span>
<span><span class="co">## [19] "CCL4"     "HLA-DPB1"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="scale-the-data-and-perform-pca-principal-component-analysis">6. Scale the Data and Perform PCA (Principal Component
Analysis)<a class="anchor" aria-label="anchor" href="#scale-the-data-and-perform-pca-principal-component-analysis"></a>
</h3>
<p>After finding variable genes, we need to convert their absolute
expression values (non-negative numbers) into relative expression values
centered around 0 (Scale data). We won’t delve into the mathematical
details for now; just understand that this is a necessary preprocessing
step for PCA.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html" class="external-link">ScaleData</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span>  <span class="co"># Scale and center the data</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html" class="external-link">RunPCA</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s view the PCA results:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/Embeddings.html" class="external-link">Embeddings</a></span><span class="op">(</span><span class="va">pbmc</span>, reduction <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                        PC_1       PC_2       PC_3      PC_4      PC_5</span></span>
<span><span class="co">## AAACATACAACCAC-1 -4.6045241  0.6234328  0.6465229 -1.705401 0.8051816</span></span>
<span><span class="co">## AAACATTGAGCTAC-1 -0.2510676 -4.5884220 -6.7836763  6.494202 0.8041997</span></span>
<span><span class="co">## AAACATTGATCAGC-1 -2.7264534  3.9110928  0.4707721 -1.051877 4.9673488</span></span>
<span><span class="co">##                        PC_6       PC_7       PC_8       PC_9      PC_10</span></span>
<span><span class="co">## AAACATACAACCAC-1  1.3371106 -0.9829216  0.9723629  1.0049179 -0.9915709</span></span>
<span><span class="co">## AAACATTGAGCTAC-1  0.3479615  2.5026386  1.7153129 -0.2690852 -1.7055348</span></span>
<span><span class="co">## AAACATTGATCAGC-1 -0.4141458  1.3973752 -0.1164631 -3.6681793 -1.7882280</span></span>
<span><span class="co">##                       PC_11       PC_12       PC_13     PC_14     PC_15</span></span>
<span><span class="co">## AAACATACAACCAC-1  2.7648129 -2.73647800  0.03257591  1.104421 0.2039551</span></span>
<span><span class="co">## AAACATTGAGCTAC-1 -0.9496004  0.04517313 -3.95095465 -0.290534 1.3674869</span></span>
<span><span class="co">## AAACATTGATCAGC-1 -0.8632643 -2.06794663  0.28307751  1.237349 0.6771384</span></span>
<span><span class="co">##                        PC_16      PC_17     PC_18      PC_19       PC_20</span></span>
<span><span class="co">## AAACATACAACCAC-1 -0.91764842 -2.3425090 -1.935044 -0.6173005  0.07987662</span></span>
<span><span class="co">## AAACATTGAGCTAC-1 -1.27620010  0.6933007 -1.041971 -1.0106712  3.18628057</span></span>
<span><span class="co">## AAACATTGATCAGC-1  0.09430755 -1.1178233 -1.081445  3.6074527 -0.96941389</span></span>
<span><span class="co">##                       PC_21    PC_22      PC_23      PC_24     PC_25      PC_26</span></span>
<span><span class="co">## AAACATACAACCAC-1 -0.4464099 2.977013 -2.2608956  1.8285233 -1.938833  0.3287967</span></span>
<span><span class="co">## AAACATTGAGCTAC-1 -3.1397007 1.199900  0.3643881  0.7815454 -1.415798 -1.0788542</span></span>
<span><span class="co">## AAACATTGATCAGC-1  0.2939763 1.217381 -0.8289563 -0.7649146  2.592341 -2.3679748</span></span>
<span><span class="co">##                       PC_27      PC_28     PC_29     PC_30      PC_31</span></span>
<span><span class="co">## AAACATACAACCAC-1  0.5973897 -2.9296143  1.797364 -2.488155  0.5064375</span></span>
<span><span class="co">## AAACATTGAGCTAC-1 -1.7775801  1.1386358  2.059770 -0.913792  3.7650826</span></span>
<span><span class="co">## AAACATTGATCAGC-1 -0.1343327 -0.9495331 -3.447740 -2.560310 -0.9065570</span></span>
<span><span class="co">##                       PC_32       PC_33      PC_34     PC_35     PC_36</span></span>
<span><span class="co">## AAACATACAACCAC-1  0.4697176  0.06315808 -0.9571942 -1.366270 2.7770016</span></span>
<span><span class="co">## AAACATTGAGCTAC-1 -1.2495015 -0.92956857  1.5932132 -1.204822 0.3090374</span></span>
<span><span class="co">## AAACATTGATCAGC-1 -0.3341321  2.69349200 -1.0030922  1.709102 0.7052956</span></span>
<span><span class="co">##                      PC_37     PC_38     PC_39      PC_40    PC_41     PC_42</span></span>
<span><span class="co">## AAACATACAACCAC-1  1.999206 -1.498573 2.6018817  0.4216312 0.436011  3.929324</span></span>
<span><span class="co">## AAACATTGAGCTAC-1 -1.620767  2.088123 0.7470088 -0.3412731 1.120158 -1.137247</span></span>
<span><span class="co">## AAACATTGATCAGC-1 -1.711020 -1.715504 0.2021419 -1.2158666 3.923903 -0.987346</span></span>
<span><span class="co">##                       PC_43      PC_44      PC_45      PC_46      PC_47</span></span>
<span><span class="co">## AAACATACAACCAC-1 -1.4731753 -0.2761208  0.1823194  0.6636269  0.2252985</span></span>
<span><span class="co">## AAACATTGAGCTAC-1 -0.3606713  1.2487916  1.4327631 -1.9882073  0.8702450</span></span>
<span><span class="co">## AAACATTGATCAGC-1 -3.0790458  2.2394521 -0.7667563 -2.0711277 -0.9689478</span></span>
<span><span class="co">##                        PC_48      PC_49      PC_50</span></span>
<span><span class="co">## AAACATACAACCAC-1  0.01373876  0.8340367 -0.7549484</span></span>
<span><span class="co">## AAACATTGAGCTAC-1  2.33959710 -0.8485600  1.3609967</span></span>
<span><span class="co">## AAACATTGATCAGC-1 -1.19704799 -2.5642534  1.2388833</span></span></code></pre>
<p>As we can see, the PCA result is a matrix with rows representing
cells and columns representing principal components (PCs).</p>
</div>
<div class="section level3">
<h3 id="cluster-the-cells">7. Cluster the Cells<a class="anchor" aria-label="anchor" href="#cluster-the-cells"></a>
</h3>
<p>We’ll implement clustering in two steps. Here, we’re using the first
10 PCs for clustering. Generally, for more complex data, you might use a
higher number of dimensions. Regarding the resolution parameter, higher
values result in finer clustering, while lower values lead to fewer
clusters. It’s important to note that more clusters aren’t always better
- the optimal number depends on your biological question.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors</a></span><span class="op">(</span><span class="va">pbmc</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>  <span class="co"># Construct a KNN graph</span></span></code></pre></div>
<pre><code><span><span class="co">## Computing nearest neighbor graph</span></span></code></pre>
<pre><code><span><span class="co">## Computing SNN</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html" class="external-link">FindClusters</a></span><span class="op">(</span><span class="va">pbmc</span>, resolution <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>  <span class="co"># Find clusters of cells</span></span></code></pre></div>
<pre><code><span><span class="co">## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of nodes: 2700</span></span>
<span><span class="co">## Number of edges: 98274</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Running Louvain algorithm...</span></span>
<span><span class="co">## Maximum modularity in 10 random starts: 0.8707</span></span>
<span><span class="co">## Number of communities: 9</span></span>
<span><span class="co">## Elapsed time: 0 seconds</span></span></code></pre>
<p>Let’s view the cluster assignments. We can see that a new column
<code>seurat_clusters</code> has been added to the meta.data, storing
the clustering information:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  orig.ident nCount_RNA nFeature_RNA RNA_snn_res.0.5</span></span>
<span><span class="co">## AAACATACAACCAC-1    pbmc_3k       2421          781               0</span></span>
<span><span class="co">## AAACATTGAGCTAC-1    pbmc_3k       4903         1352               3</span></span>
<span><span class="co">## AAACATTGATCAGC-1    pbmc_3k       3149         1131               0</span></span>
<span><span class="co">## AAACCGTGCTTCCG-1    pbmc_3k       2639          960               5</span></span>
<span><span class="co">## AAACCGTGTATGCG-1    pbmc_3k        981          522               6</span></span>
<span><span class="co">## AAACGCACTGGTAC-1    pbmc_3k       2164          782               0</span></span>
<span><span class="co">##                  seurat_clusters</span></span>
<span><span class="co">## AAACATACAACCAC-1               0</span></span>
<span><span class="co">## AAACATTGAGCTAC-1               3</span></span>
<span><span class="co">## AAACATTGATCAGC-1               0</span></span>
<span><span class="co">## AAACCGTGCTTCCG-1               5</span></span>
<span><span class="co">## AAACCGTGTATGCG-1               6</span></span>
<span><span class="co">## AAACGCACTGGTAC-1               0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="run-umap-for-visualization">8. Run UMAP for Visualization<a class="anchor" aria-label="anchor" href="#run-umap-for-visualization"></a>
</h3>
<p>Now we’ll run UMAP (Uniform Manifold Approximation and Projection)
for visualization:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html" class="external-link">RunUMAP</a></span><span class="op">(</span><span class="va">pbmc</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Let’s visualize the clusters on the UMAP:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="2.Seurat_files/figure-html/unnamed-chunk-19-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="annotate-cell-types">9. Annotate Cell Types<a class="anchor" aria-label="anchor" href="#annotate-cell-types"></a>
</h3>
<p>At this point, we have clusters named with numbers. But how do we
determine what cell types these clusters represent, and how can we
rename these numerical clusters with actual cell type names?</p>
<p>Cell annotation is a vast topic that we can’t cover comprehensively
in this course. For now, we’ll focus on the most basic operations, with
the opportunity to delve deeper later.</p>
<p>First, let’s visualize the expression of known marker genes to
determine what cell types these clusters represent:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html" class="external-link">FeaturePlot</a></span><span class="op">(</span></span>
<span>  <span class="va">pbmc</span>,</span>
<span>  features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"MS4A1"</span>, <span class="st">"GNLY"</span>, <span class="st">"CD3E"</span>,</span>
<span>    <span class="st">"CD8A"</span>, <span class="st">"CCR7"</span>, <span class="st">"CD14"</span>,</span>
<span>    <span class="st">"FCER1A"</span>, <span class="st">"FCGR3A"</span>, <span class="st">"PPBP"</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="2.Seurat_files/figure-html/unnamed-chunk-20-1.png" width="864"></p>
<p>Now, let’s assign cell type labels based on marker gene expression.
We’ll rename clusters 0-8 with our desired cell type names. This process
utilizes the properties and techniques of factors that we learned
earlier.</p>
<p>First, let’s examine the <code>seurat_clusters</code> column in
meta.data:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">$</span><span class="va">seurat_clusters</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1 AAACCGTGCTTCCG-1 </span></span>
<span><span class="co">##                0                3                0                5 </span></span>
<span><span class="co">## AAACCGTGTATGCG-1 AAACGCACTGGTAC-1 </span></span>
<span><span class="co">##                6                0 </span></span>
<span><span class="co">## Levels: 0 1 2 3 4 5 6 7 8</span></span></code></pre>
<p>We can see this is a factor. Note that we used <code>$</code>
directly on the Seurat object. We previously learned that <code>@</code>
is used to access specific object slots, while <code>$</code> is more
flexible, depending on how the developer defines it. For Seurat objects,
since meta.data is one of the most commonly used tables, the developers
set <code>$</code> to directly access meta.data columns. Here,
<code>pbmc$seurat_clusters</code> is equivalent to
<code>pbmc@meta.data$seurat_clusters</code>.</p>
<p>Now, let’s copy the <code>seurat_clusters</code> column in meta.data
to a new column called <code>cluster</code>:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="va">pbmc</span><span class="op">$</span><span class="va">seurat_clusters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1 AAACCGTGCTTCCG-1 </span></span>
<span><span class="co">##                0                3                0                5 </span></span>
<span><span class="co">## AAACCGTGTATGCG-1 AAACGCACTGGTAC-1 </span></span>
<span><span class="co">##                6                0 </span></span>
<span><span class="co">## Levels: 0 1 2 3 4 5 6 7 8</span></span></code></pre>
<p>Since this is a factor, we can use the method we learned in the
previous lesson to change the level names. We just need to change the
current 0-8 to the corresponding cell types:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new.cluster.ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4 T Naive"</span>, <span class="st">"CD4 T Memory"</span>, <span class="st">"Mono CD14"</span>, <span class="st">"B cell"</span>, <span class="st">"CD8 T cell"</span>, <span class="st">"Mono FCGR3A"</span>, <span class="st">"NK cell"</span>, <span class="st">"DC"</span>, <span class="st">"Platelet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">new.cluster.ids</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1 AAACCGTGCTTCCG-1 </span></span>
<span><span class="co">##      CD4 T Naive           B cell      CD4 T Naive      Mono FCGR3A </span></span>
<span><span class="co">## AAACCGTGTATGCG-1 AAACGCACTGGTAC-1 </span></span>
<span><span class="co">##          NK cell      CD4 T Naive </span></span>
<span><span class="co">## 9 Levels: CD4 T Naive CD4 T Memory Mono CD14 B cell CD8 T cell ... Platelet</span></span></code></pre>
<p>Let’s view the new annotation results:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, label <span class="op">=</span> <span class="cn">TRUE</span>, group.by <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2.Seurat_files/figure-html/unnamed-chunk-24-1.png" width="576"></p>
<p>We can also sort the levels alphabetically:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">$</span><span class="va">cluster</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s visualize the final annotated UMAP:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, label <span class="op">=</span> <span class="cn">TRUE</span>, group.by <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2.Seurat_files/figure-html/unnamed-chunk-26-1.png" width="672"></p>
<p>We can change the default idents, so we don’t need to specify the
<code>group.by</code> parameter every time we use DimPlot:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/Idents.html" class="external-link">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'cluster'</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="2.Seurat_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
<p>With this, we’ve completed the entire process from raw count matrix
to annotated UMAP. This is a significant milestone in single-cell
analysis. In the upcoming lessons, we’ll learn various visualization
methods using the SeuratExtend package, as well as various advanced
analyses.</p>
<p>Let’s save the current Seurat object as an RDS file:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a new folder called 'rds' and save pbmc into it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"rds"</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">pbmc</span>, file <span class="op">=</span> <span class="st">"rds/pbmc_annotated.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, let’s install SeuratExtend in preparation for the next
lessons:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If you haven't installed remotes yet:</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"huayc09/SeuratExtend"</span><span class="op">)</span></span></code></pre></div>
<p>This concludes our basic single-cell analysis workflow with Seurat.
In the next lessons, we’ll explore more advanced techniques and
visualizations using SeuratExtend.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Yichao Hua.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
